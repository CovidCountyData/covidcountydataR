---
title: "usage"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{usage}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(cmdcR)
```

Welcome to the cmdcR docs!

As of right now, this library is a wrapper around the [cmdc.py](https://github.com/valorumdata/cmdc.py) Python client. For more examples and documentation, please see that library. If you are an R programmer and are willing to contribute to making a native library, please reach out at our [repository](https://github.com/valorumdata/cmdcR)!

Also, please see the [project website](https://covid.valorum.ai) for more information.

## Usage

### tl;dr
 
There are a few steps to using `cmdcR`:

1. Create a client `cl <- client()`
2. (Optional, one-time) Register for an API key `register(cl)`
3. Construct a dataset: e.g. `cl %>% covid(state="FL") %>% demographics(variable="Median age")`
4. Fetch the dataset (could also be passed as final funciton in ` %>% ` chain): `df <- fetch(cl)`

Here's what the above example would have looked like:

```{r}
cl <- client()
df <- cl %>% covid(state="FL") %>% demographics(variable="Median age") %>% fetch()
df
```


### Exploring the API

You can see which datasets are available using the `datasets` method:

```{r}
datasets(cl)
```

You can get information and help on a dataset, by using the `info` method

```{r}
info(cl, "demographics")
```

or

```{r}
info(cl, "mobility_devices")
```


### Example

Let's build a map of total cases as of June 9, 2020 (date of writing)

```{r}
library(usmap)
library(ggplot2)

df <- cl %>% covid(variable="deaths_total", fips=c(1:60), dt="2020-06-05") %>% fetch()


plot_usmap(data = df, values = "deaths_total") + 
  scale_fill_continuous(
     type="viridis", name = "Cumulative Deaths", label = scales::comma
  ) + theme(legend.position = "right")
```

